<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Controle de Vencimento â€“ P&B Casa de RaÃ§Ãµes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .logo {
      text-align: center;
      margin-bottom: 20px;
    }
    .logo img {
      width: 60px;
    }
    input {
      padding: 10px;
      margin: 5px;
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      margin-top: 20px;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ccc;
      text-align: center;
    }
    th {
      background-color: #eee;
    }
    .status-ok {
      color: green;
      font-weight: bold;
    }
    .status-warning {
      color: orange;
      font-weight: bold;
    }
    .status-expired {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="logo">
    <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Logo da loja">
    <h1>Controle de Vencimento â€“ P&B Casa de RaÃ§Ãµes</h1>
  </div>

  <div>
    <input type="text" id="nome" placeholder="Nome da RaÃ§Ã£o" />
    <input type="number" id="quantidade" placeholder="Quantidade" />
    <input type="date" id="validade" />
    <button onclick="adicionarRacao()">ðŸ“¤ Adicionar</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Produto</th>
        <th>Quantidade</th>
        <th>Validade</th>
        <th>Faltam</th>
        <th>Status</th>
        <th>ðŸ“¥</th>
      </tr>
    </thead>
    <tbody id="tabela-corpo"></tbody>
  </table>

  <script>
    const telefone = "556296094975";
    const apikey = "2198964";

    function salvar(dados) {
      localStorage.setItem("racoes", JSON.stringify(dados));
    }

    function carregar() {
      return JSON.parse(localStorage.getItem("racoes") || "[]");
    }

    function calcularDias(validade) {
      const hoje = new Date();
      const dataValidade = new Date(validade);
      const diff = Math.ceil((dataValidade - hoje) / (1000 * 60 * 60 * 24));
      return diff;
    }

    function enviarWhatsApp(mensagem) {
      const url = `https://api.callmebot.com/whatsapp.php?phone=${telefone}&text=${encodeURIComponent(mensagem)}&apikey=${apikey}`;
      fetch(url)
        .then(res => console.log("Mensagem enviada:", mensagem))
        .catch(err => console.error("Erro ao enviar:", err));
    }

    function atualizarTabela() {
      const lista = carregar();
      const corpo = document.getElementById("tabela-corpo");
      corpo.innerHTML = "";

      lista.forEach((item, i) => {
        const dias = calcularDias(item.validade);
        let status = "Ok";
        let classe = "status-ok";

        if (dias < 0) {
          status = "VENCIDO";
          classe = "status-expired";
          enviarWhatsApp(`âš ï¸ AVISO: O produto "${item.nome}" (Quantidade: ${item.quantidade}) estÃ¡ VENCIDO!`);
        } else if (dias <= 45) {
          status = `Vencendo em ${dias} dias`;
          classe = "status-warning";
          enviarWhatsApp(`âš ï¸ AtenÃ§Ã£o! A raÃ§Ã£o "${item.nome}" (Quantidade: ${item.quantidade}) estÃ¡ vencendo em ${dias} dias.`);
        }

        corpo.innerHTML += `
          <tr>
            <td>${item.nome}</td>
            <td>${item.quantidade}</td>
            <td>${item.validade}</td>
            <td>${dias}</td>
            <td class="${classe}">${status}</td>
            <td><button onclick="removerRacao(${i})">ðŸ“¥</button></td>
          </tr>
        `;
      });
    }

    function adicionarRacao() {
      const nome = document.getElementById("nome").value.trim();
      const quantidade = document.getElementById("quantidade").value;
      const validade = document.getElementById("validade").value;

      if (!nome || !quantidade || !validade) {
        alert("Preencha todos os campos!");
        return;
      }

      const lista = carregar();
      lista.push({ nome, quantidade, validade });
      salvar(lista);
      atualizarTabela();

      document.getElementById("nome").value = "";
      document.getElementById("quantidade").value = "";
      document.getElementById("validade").value = "";
    }

    function removerRacao(index) {
      const lista = carregar();
      lista.splice(index, 1);
      salvar(lista);
      atualizarTabela();
    }

    atualizarTabela();
  </script>

</body>
</html>